{{/* psipred_jobs.html - simple jobs table */}}
<!doctype html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <title>PSIPRED Jobs — DRD4</title>
    <link href="/static/styles.css" rel="stylesheet" />
</head>

<body>
    <div class="container">
        {{ template "header.html" . }}

        <main class="panel" style="margin-top:12px">
            <div style="display:flex; align-items:center; justify-content:space-between; gap:12px">
                <div>
                    <h2>PSIPRED Jobs</h2>
                    <p class="meta">Acompanhamento simples dos jobs registrados no database.json</p>
                </div>
                <div>
                    <button id="psipred-submit-all" class="btn">Enviar todos</button>
                </div>
            </div>

            {{ if . }}
            <table class="jobs" id="psipred-jobs-table" hx-get="/psipred-jobs/fragment" hx-trigger="every 30s"
                hx-swap="outerHTML">
                <thead>
                    <tr>
                        <th>Job ID</th>
                        <th>Variant</th>
                        <th>Remote UUID</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="psipred-jobs-tbody">
                    {{ range . }}
                    <tr>
                        <td><code>{{ .ID }}</code></td>
                        <td><a href="/variant/{{ .VariantCode }}">{{ .VariantCode }}</a></td>
                        <td>{{ if .RemoteUUID }}<a href="/psipred/job/{{ .RemoteUUID }}">{{ .RemoteUUID }}</a>{{ else
                            }}—{{ end }}</td>
                        <td>
                            {{/* Prefer remote state if available, otherwise show local state */}}
                            {{ $s := .State }}
                            {{ if .RemoteState }}
                            {{ $s = .RemoteState }}
                            {{ end }}
                            <span class="badge">{{ $s }}</span>
                        </td>
                        <td>
                            <a class="btn secondary view-link" href="/psipred/job/{{ or .RemoteUUID .ID }}">Ver</a>
                        </td>
                    </tr>
                    {{ end }}
                </tbody>
            </table>
            {{ else }}
            <div class="meta">Nenhum job PSIPRED encontrado.</div>
            {{ end }}

            <!-- Failures summary (filled by client via API) -->
            <section id="psipred-failures" style="margin-top:18px; display:none">
                <h3>Falhas recentes</h3>
                <div class="meta">As submissões abaixo falharam e podem ser reenviadas manualmente.</div>
                <ul id="psipred-failures-list"></ul>
            </section>

            <!-- Progress modal (managed by client JS) -->
            <div id="psipred-progress-modal" class="modal" aria-hidden="true" role="dialog">
                <div class="modal-backdrop" data-dismiss="modal"></div>
                <div class="modal-panel">
                    <header class="modal-header">
                        <h3>Enviando em lote</h3>
                        <button class="btn secondary" id="psipred-progress-close">Fechar</button>
                    </header>
                    <div class="modal-body">
                        <div id="psipred-progress-summary">Preparando...</div>
                        <div class="progress" style="margin-top:12px">
                            <div id="psipred-progress-bar" class="progress-bar" style="width:0%"></div>
                        </div>
                        <ul id="psipred-progress-list" style="margin-top:12px; max-height:240px; overflow:auto"></ul>
                    </div>
                </div>
            </div>

        </main>
    </div>
    <!-- Modal for job details -->
    <div id="job-modal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="job-modal-title">
        <div class="modal-backdrop" data-dismiss="modal"></div>
        <div class="modal-panel">
            <header class="modal-header">
                <h3 id="job-modal-title">Job details</h3>
                <button class="btn secondary" id="modal-close">Fechar</button>
            </header>
            <div class="modal-body" id="job-modal-body">
                <pre id="job-modal-pre">Carregando...</pre>
            </div>
        </div>
    </div>
</body>

</html>