{{/* detail.html - single clean fragment for a variant */}}
<div class="panel">
    <div class="detail-title">
        <h2 style="margin:0">{{.VariantCode}}</h2>
        <div class="meta">— {{.Name}}</div>
    </div>

    <p class="meta" style="margin-top:8px">
        <strong>Fonte:</strong> {{.TranslationSource}} • <strong>PB:</strong> {{.PBCount}} • <strong>AA:</strong>
        {{.AACount}}
        {{if .PsipredUUID}} • <strong>UUID:</strong> <code>{{.PsipredUUID}}</code>{{end}}
        <span id="psipred-status" style="margin-left:8px; color:var(--muted)"></span>
    </p>

    <section class="actions" style="margin-top:12px; display:flex; gap:8px; align-items:center; flex-wrap:wrap">
        <form method="get" action="/variant/{{.VariantCode}}">
            <button class="btn secondary" type="submit">Atualizar</button>
        </form>
        {{if .PsipredUUID}}
        <!-- If the variant already has a PSIPRED UUID, show a direct link to the PSIPRED site -->
        <a class="btn primary" href="https://bioinf.cs.ucl.ac.uk/psipred/&uuid={{.PsipredUUID}}" target="_blank"
            rel="noopener">Acessar PSIPRED</a>
        {{else}}
        <!-- Instead of direct submit, open a preview modal that shows the FASTA to be sent -->
        <button class="btn primary" id="preview-send" data-variant="{{.VariantCode}}">Enviar PSIPRED</button>
        {{end}}
        <button class="btn secondary"
            onclick="(function(){navigator.clipboard.writeText('{{js .TranslateMergedRef}}')})()">Copiar
            TranslateMergedRef</button>
        <a class="btn secondary" href="data:text/plain;charset=utf-8,{{urlquery .TranslateMergedRef}}"
            download="{{.VariantCode}}_translate.fasta">Baixar FASTA</a>
    </section>

    {{if .UnsubstitutedPositions}}
    <div style="margin-top:12px">
        <strong>Posições não substituídas</strong>
        <div style="margin-top:8px; display:flex; gap:6px; flex-wrap:wrap">
            {{- range .UnsubstitutedPositions}}
            <div style="background:#fff;padding:6px 8px;border-radius:8px;border:1px solid #eef3fb;font-size:13px">{{.}}
            </div>
            {{- end}}
        </div>
    </div>
    {{end}}

    <!-- copy / download moved into actions row -->

    <h3 style="margin-top:16px">Nucleotídeos</h3>
    <pre>{{.Nucleotides}}</pre>

    <h3>Traduzido</h3>
    <pre>{{.Translated}}</pre>

    <h3>Alinhamento</h3>
    <pre>{{.NucleotidesAlign}}</pre>

    <h3 style="margin-top:12px">TranslateMergedRef</h3>
    <pre id="translate-merged-ref">{{.TranslateMergedRef}}</pre>
</div>

<!-- Preview modal for FASTA before sending -->
<div id="fasta-preview-modal" class="modal" aria-hidden="true">
    <div class="modal-backdrop" data-dismiss="modal"></div>
    <div class="modal-panel">
        <header class="modal-header">
            <h3 id="fasta-preview-title">Preview FASTA</h3>
            <button class="btn secondary" id="fasta-preview-close">Fechar</button>
        </header>
        <div class="modal-body">
            <pre id="fasta-preview-body">Carregando...</pre>
        </div>
        <footer style="padding:12px;display:flex;gap:8px;justify-content:flex-end">
            <button class="btn secondary" id="fasta-send-cancel">Cancelar</button>
            <button class="btn primary" id="fasta-send-confirm">Confirmar e Enviar</button>
        </footer>
    </div>
</div>